<div>
    <button id="newsletter-subscribe-button" style="display: none" class="wp-block-button__link has-vivid-cyan-blue-background-color has-background">Subscribe</a>
</div>

<script>
    let subscribedId = 'subscribed-message';
    function onClick() {
        fetch('/wp-json/newsletter/v1/subscribe', { 
            method: 'POST', 
            headers: {
                'Content-Type': 'application/json',
                'X-WP-Nonce': '{{wordpressNonce}}'
            },
            body: '{}'
        }).then(response => response.json())
        .then(data => {
            if (data.json().status == 'subscribed') {
                showSubscribedMessage();
            } else {
                console.log(data);
            }
        }).catch(err => console.error(err));
    }

    function showSubscribedMessage() {
        let button = document.getElementById('newsletter-subscribe-button');
        button.style.display = 'none';
        let subMessage = document.createElement('p');
        subMessage.id =  subscribedId;
        subMessage.innerText = 'You are currently subscribed to the SAIL newsletter.';
        subMessage.style.display = 'block';
        button.parentNode.appendChild(subMessage);
    }

    function showSubscribeButton() {
        let button = document.getElementById('newsletter-subscribe-button');
        button.style.display = 'block';
        button.onclick = onClick;
        subMessage = document.getElementById(subscribedId);
        if (subMessage) {
            subMessage.style.display = 'none';
        }
    }

    window.onload = function() {
        if ({{isSubscribed}}) {
            showSubscribedMessage();
        } else {
            showSubscribeButton();
        }
    }
</script>
